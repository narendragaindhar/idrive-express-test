# This workflow will be triggered manually to deploy code in Heroku

name: Deploy Code to Heroku
on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Select Environment'
        type: choice
        required: true
        default: 'staging'
        options:
          - production
          - staging
      tag:
        description: 'Select Git Tag to Deploy'
        type: choice
        required: false
jobs:
  deploy:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Fetch all tags
        run: git fetch --tags

      - name: Update Version File and Create Tag
        run: |
          if [ -n "${{ github.event.inputs.tag }}" ]; then
            echo "Updating version file with tag: ${{ github.event.inputs.tag }}"
            echo "${{ github.event.inputs.tag }}" > config/version
            git add config/version
            git commit -m "Update version file for tag: ${{ github.event.inputs.tag }}"
            git push origin "${{ github.event.inputs.tag }}"
          else
            echo "No tag specified. Skipping version file update."
          fi
